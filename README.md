# Сверка 

   <img src="https://img.shields.io/badge/Version-1.2.3%20-blue" alt="Sverka">
   <img src="https://img.shields.io/badge/License-MIT-brightgreen" alt="License">

 
Программа для обработки данных из форматов XML, CSV и XLSX. Включает в себя два сценария: обработка файлов и выборка данных из программного комплекса для обработки. Реализована посредством интеграции SQLite и Selenuim.

## Содержание
- [Технологии](#технологии)
- [Использование](#использование)
    * [Настройка перед использованием](#настройка-перед-использованием)
    * [Использование](#использование)
- [Разработка](#разработка)
    * [Компиляция](#компиляция)
- [Содержание конфигурационных файлов](#содержание-конфигурационных-файлов)

## Технологии
- [Python 3.8.7](https://www.python.org/downloads/release/python-387/)
- [sqlite3](https://docs.python.org/3/library/sqlite3.html)
- [selenium](https://pypi.org/project/selenium/)
- [pandas](https://pandas.pydata.org/)

## Использование

#### Настройка перед использованием

Для работы необходимо разархивировать в корень диска C:\ архив ``soft_for_py_exe`` и, в удобное для вас место, архив с рабочей директорией ``Sverka v... (compiled)`` (находятся в Releases)

Также необходима правка путей в `config/Common/routes.json`


### Использование
Запуск сценария ``Обработка`` может быть произведен совместно с выборкой, в таком случае сначала выполнится сценарий ``Выборка``, а потом уже ``Обработка``.

При запуске сценария ``Обработка`` программа на вход принимает директорию, в которой находятся все необходимые для обработки файлы. Она располагается в рабочей директории: ``IN/{ТИП ОБРАБОТКИ}``

Пример структуры директорий для обработки:

```
#РПВ
IN (dir) =>
  РПВ (dir) =>
      КАРТОТЕКА РАЗОВОЙ (dir) -.xlsx
      VIB (dir) -.csv
      XML (dir) 
      
# МСП
IN (dir) =>
  МСП (dir) =>
      MITS (dir) -.xlsx
      VIB (dir) -.csv

# ФСС
IN (dir) =>
  МСП (dir) =>
      XLSX (dir) 
      VIB (dir) 
```
Ключевую роль играют названия директорий, если они будут называться иначе, то программа выдаст ошибку.

Более подробную информацию читайте в файле `Sverka - Руководство пользователя`, который находится в архиве релиза

## Разработка

### Компиляция:
```sh
pyinstaller  --icon=ic.ico --onefile --windowed --name Сверка gui.py
```

```sh
pyinstaller  sverka.spec
```

## Содержание конфигурационных файлов

При первом запуске программы она затребует ввести логин и пароль от НВП, эти данные автоматически запишутся в ``config/Common/login.json``, при необходимости можно внести изменения в файл вручную.
 
Для смены сервера, на котором будет происходить выборка, необходимо изменить URL адреса в ``config/Common/routes.json``

Конфигурация для основных полей выборки располагается в ``config/Other``
В разделе `vib-fields` указаны все наименования элементов полей выборок, которые в свою очередь подразделяются на database, tables, fields. 

Структура названий не должна изменяться:

 `“database”` включает в себя массив наименования баз данных, например `“PF”` или `“VPL”` 
`“tables”` включает в себя массив наименований таблиц из вышеуказанной БД, корректная запись – `“PF_MAN”` или `“VPL_POPAY”`
`“fields”` представляет наименования полей таблиц, например `“MAN_DSM”` или `“POPAY_PW”`

Раздел `filling-data` включает в себя все ID веб. форм, в которые задаются необходимые нам значения, а также указаны сами значения. Он также имеет подразделы. 

 Например,

```json
"filling-data": {
    "dsm": {
      "select": "указывает на ID выпадающего меню",
      "option": "указывает ID необходимого значения в выпадающем списке(int)",
      "set": "указывает на ID поля, в которое должно быть установлено значение",
      "set_keys": "указывает на устанавливаемое значение и т.п.",
    },
}
```

`"set_keys"` в определенных случаях может иметь иное название, например для указания районов в Москве, структура `filling-data` будет с указанием не просто `"set_keys"`, а `"set_keys_M"` или `"set_keys_MO"` (при реализации новой выборки необходимо внести условие difference в модуль vib_routes)